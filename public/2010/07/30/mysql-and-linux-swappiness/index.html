
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>MySQL and Linux swappiness - The Technician</title>
	<meta name="author" content="Chris Henry">

	
	<meta name="description" content="MySQL&#8217;s InnoDB engine is really great. Row-level locking is amazing in tables
where there is heavy concurrency. Write buffering is also awesome &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="The Technician" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.ico" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	
</head>

<body>
	<header id="header" class="inner"><h1><a href="/">The Technician</a></h1>
<nav id="main-nav"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="http://google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:chr.ishenry.com">
			</form>
		</div>
	</div>
</nav>
<nav id="sub-nav" class="alignright">
	<div class="social">
		
		
		
		<a class="twitter" href="http://twitter.com/chrishnry" title="Twitter">Twitter</a>
		
		
		<a class="github" href="https://github.com/chrishenry" title="GitHub">GitHub</a>
		
    
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
		<a class="feedly" title="Feedly" href="http://cloud.feedly.com/#subscription%2Ffeed%2Fhttp%3A%2F%2Fchr.ishenry.com%2Fatom.xml" target="blank">Feedly</a>
	</div>
	<form class="search" action="http://google.com/search" method="get">
		<input class="alignright" type="text" name="q" results="0">
		<input type="hidden" name="q" value="site:chr.ishenry.com">
	</form>
</nav>

</header>
	
		
<div id="banner" class="inner">
	<div class="container">
		<ul class="feed"></ul>
	</div>
	<small><a href="http://twitter.com/chrishnry">chrishnry</a> @ <a href="http://twitter.com">Twitter</a></small>
	<div class="loading">Loading...</div>
</div>
<script src="/javascripts/twitter.js"></script>
<script type="text/javascript">
	(function($){
		$('#banner').getTwitterFeed('chrishnry', 4, false);
	})(jQuery);
</script>

	
	<div id="content" class="inner"><article class="post">
	<h2 class="title">MySQL and Linux Swappiness</h2>
	<div class="entry-content"><p>MySQL&#8217;s InnoDB engine is really great. Row-level locking is amazing in tables
where there is heavy concurrency. Write buffering is also awesome for cases
where a table needs to accept a lot of data. InnoDB&#8217;s use of memory to store
indexes or sometimes the entire table can also make reads incredibly fast,
especially on tables that need to support complex queries where even the best
placed indexes do nothing.</p>

<p>However, when tables get large, the innodb_buffer_pool is set to close to
amount of memory on the server, Linux has a tendency to remove your data from
memory for no good reason. The symptoms are unmistakable: a query that was
known to be pretty quick, but hasn&#8217;t run in a while, will take long. Too long.
Run it again, and it becomes snappy. What&#8217;s happening is that when the query
initially runs, the necessary data isn&#8217;t in memory, so it&#8217;s read in from disk,
and the query is performed. Once it&#8217;s in memory, that second run is quick.</p>

<p>Actually there is a good reason Linux behaves like this:</p>

<blockquote><p>&#8220;My point is that decreasing the tendency of the kernel to swap stuff out is
wrong. You really don&#8217;t want hundreds of megabytes of BloatyApp&#8217;s untouched
memory floating about in the machine. Get it out on the disk, use the memory
for something useful.&#8221;</p></blockquote>

<ul>
<li><a href="http://kerneltrap.org/node/3000">[http://kerneltrap.org/node/3000](http://kerneltrap.org/node/3000)</a></li>
</ul>


<p>This all makes sense, as most systems need to reclaim memory from applications
that aren&#8217;t doing anything. Except in the case where you have a large dataset
in InnoDB that you&#8217;d really like to be in memory when you query it. Luckily,
there is a tunable that you can change to dictate how aggressive Linux is
reclaiming memory from applications. /proc/sys/vm/swappiness stores a number
for 0 to 100, where 100 means that Linux will be extremely aggressive in
reclaiming memory, and 0 means that memory won&#8217;t be reclaimed all that much.</p>

<p>For servers that need to keep datasets in memory all the time, this variable
can be extremely helpful. With an InnoDB table / indexes that consume ~80% of
memory on the machine, a swappiness value of 30 is sufficient to allow MySQL
to keep most of that in memory. Of course, I don&#8217;t recommend this for a
machine that is not 100% dedicated to a single task. However, on dedicated
MySQL machines, tuning this variable can be really helpful.</p>
</div>


<div class="meta">
	<div class="date">








  


<time datetime="2010-07-30T00:00:00-04:00" pubdate data-updated="true">Jul 30<span>th</span>, 2010</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/mysql/'>MySQL</a>


</div>
	
</div></article>

	<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
	
	<a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
	
	
	<a class="addthis_button_tweet"></a>
	
	
	<a class="addthis_counter addthis_pill_style"></a>
	</div>
  <script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid="></script>
</div>


</div>
	<footer id="footer" class="inner">Copyright &copy; 2013

    Chris Henry

</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->


<script type="text/javascript">
      var disqus_shortname = 'thetechnician';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-6652794-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>



</body>
</html>