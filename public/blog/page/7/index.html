
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>The Technician</title>
	<meta name="author" content="Chris Henry">

	
	<meta name="description" content="In life there are people who will consider themselves Jacks of all Trades. But
as the saying goes, they are master of none. Websites will always &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="The Technician" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script async="true" src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	
</head>


<body>
	<header id="header" class="inner"><h1><a href="/">The Technician</a></h1>
<nav id="main-nav"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="http://google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:chr.ishenry.com">
			</form>
		</div>
	</div>
</nav>
<nav id="sub-nav" class="alignright">
	<div class="social">
		
		
		
		<a class="twitter" href="http://twitter.com/chrishnry" title="Twitter">Twitter</a>
		
		
		<a class="github" href="https://github.com/chrishenry" title="GitHub">GitHub</a>
		
    
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
    
		
		<a class="feedly" title="Feedly" href="http://cloud.feedly.com/#subscription%2Ffeed%2Fhttp%3A%2F%2Fchr.ishenry.com%2Fatom.xml" target="blank">Feedly</a>
		
	</div>
	<form class="search" action="http://google.com/search" method="get">
		<input class="alignright" type="text" name="q" results="0">
		<input type="hidden" name="q" value="site:chr.ishenry.com">
	</form>
</nav>

</header>
	<div id="content" class="inner">


    <article class="post">
	<h2 class="title">
		
		<a href="/2009/07/08/do-one-thing-but-do-it-really-well/">
		
			Do One Thing, but Do It Really Well</a>
	</h2>
	<div class="entry-content">
		<p>In life there are people who will consider themselves Jacks of all Trades. But
as the saying goes, they are master of none.</p>

<p>Websites will always start out as a codebase that does everything. There will
be a couple files that add users, encode video to Flash, pull rss feeds,
assemble HTML, update products, charge users, manipulate images, redirect old
links, handle file uploads, calculate shipping, delete categories, create rss
feeds, search the database, etc. Sometimes the code to do these will be
organized into files, sometimes it won&#8217;t. The whole site will run on a single
server, or more likely, a slice of a single server.</p>

<p>None of the things in the above list will be done well. None. This is mostly
because there is too little code and too little hardware focused on doing too
much. Also, every piece of code will be tightly coupled. So any one of those
features could potentially get a ton of traffic, or hit a bump, and consume a
ton of resources. Once that happens, it&#8217;s safe to assume the whole thing will
go down in flames.</p>

<p>So to avoid the Fail Whale, its really important to build sites as a group of
components that work together. <a href="http://bit.ly/TunGR">Architecture</a> is key, and
when carefully thought out, can ensure that the most important parts of the
site stay up. Even when your image manipulation script on the backend freaks
out, the home page should continue to load flawlessly.</p>

<p>With database-driven apps (almost every major site on the web), there needs to
be particular attention paid to a caching layer. Again, since most sites start
out with a jumbled codebase, the likelihood that all the code to manage data
is in the same place is unlikely. Given the complexities of managing cache
objects, making sure that objects are invalidated on update is crucial to
making updates look seamless. So there needs to be a set of code that&#8217;s good
at one thing: managing data and its cache.</p>

<p>Search is another area that commonly relies on database, and can eat a ton of
resources. If performing search in SQL, difficult queries can lock tables and
keep other queries from being answered. As good as some DBMSes have gotten at
handling search ( ie MySQL&#8217;s FULLTEXT ), they still can&#8217;t fulfill the
concurrency demands of a site with heavy traffic. So, again, the solution is a
change where a resource intensice feature needs to be isolated from other
code. There are a few different ways to do this. One is running replication,
which may not be possible in smaller hosting environments. Another is to use
Full Text Search (Lucene, Sphinx, etc.) Again, this may not be possible in
smaller hosting environments.</p>

<p>Using code that&#8217;s already good at managing and retrieving data, an interface
can be built to query your data. A second hosting environment that&#8217;s suitable
for running the search tool of your choice can then query the data code for
updates it needs to keep itself updated. In turn, this server will return
search results without tying up any resources necessary for doing important
stuff, like serving the home page.</p>

<p>So in these two short examples, we&#8217;ve created a theoretical architecture that
can sustain heavy, site-breaking traffic to the search, and still continue to
serve the home page. Of course, until the Apache server becomes so inundated
with requests that it can&#8217;t do anything. Then it&#8217;s time to get that load
balancer in placeâ€¦</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2009-07-08T00:00:00-04:00" pubdate data-updated="true">Jul 8<span>th</span>, 2009</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/development/'>Development</a>, <a class='category' href='/blog/categories/web-architecture/'>Web Architecture</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/2009/07/01/explain-your-code/">
		
			Explain Your Code</a>
	</h2>
	<div class="entry-content">
		<p>In my search to expand my dev team, I use a code sample as one of the main
determining factors. During an interview, I will always make the same request:</p>

<p>&#8220;Give us a code sample. It can be something that you think is really great, or
something you think really sucks. Most importantly, tell us why you think it&#8217;s
great, or why you think it sucks.&#8221;</p>

<p>No one seems to able to do it. I have received code samples that consist of
stream wrappers, database wrappers, complete websites, etc. Some have been
really good, and some have been outright scary. But very few candidates have
been able to communicate what they think of their own code and why.</p>

<p>Which is very surprising, given most developers&#8217; proclivity to judge others&#8217;
code as total crap without a second thought (guilty).</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2009-07-01T00:00:00-04:00" pubdate data-updated="true">Jul 1<span>st</span>, 2009</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/web-dev-teams/'>Web Dev Teams</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/2009/06/30/zombie-projects/">
		
			Zombie Projects</a>
	</h2>
	<div class="entry-content">
		<p>A Zombie Project is any project that has been completed for a while but needs
to be changed or updated in some way. After laying dormant for a while, the
team that developed it may have left, or evolved into a different team, or
changed their methodology entirely.</p>

<p>While the project was dormant, it is extremely likely, if not definite that
knee-jerk reactions to bugs have caused changes that no one remembers, much
less committed. So when development starts on the project sandbox, if it still
exists, it is more likely than not that everything is out of date. In this
case, bite the bullet. FTP the whole codebase down, and check it against the
repo. Your life will probably be miserable for a bit, but at least there won&#8217;t
be any horrible surprises later. Also, if there&#8217;s a sandbox, triple check it.
If not, be glad there&#8217;s nothing you&#8217;ll miss in an old one.</p>

<p>If this project is only being opened for a short period, resist the urge to
make small changes in methodology or framework. For every small change you
make, you&#8217;ll want to make another, and update this, and modify that. Be
extremely careful of the budget, and cost of each change, or you&#8217;re done for.</p>

<p>Lastly, be very, very afraid of the build to production. Even with fastidious
notes, a sys admin with OCD, and Gillian the QA girl telling you how awesome
you are, assume you missed something. An open tail of the error log is your
best visibility into whatever has reared it&#8217;s ugly head. Your next best bet is
your trusty <a href="http://bit.ly/96yBC">Crisis MO</a>.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2009-06-30T00:00:00-04:00" pubdate data-updated="true">Jun 30<span>th</span>, 2009</time></div>
	<div class="tags">

</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/2009/06/07/document-failure/">
		
			Document Failure</a>
	</h2>
	<div class="entry-content">
		<p>When things go wrong, there is always a reason. Sometimes it&#8217;s a good one. (I
had no idea $_SERVER wasn&#8217;t available from the CLI) Sometimes it&#8217;s a really
bad one. (I left 2 seconds after running the build script, and I didn&#8217;t test
beforehand.) Whatever the reason is, the question needs to be asked &#8216;How can
we never, ever let this happen again?&#8217; Once we arrive at a good answer to that
question, it&#8217;s really important that you hold that answer in a vise-like grip,
and never let it go. Because knowing how to prevent problems, and actually
taking the steps to prevent them are two very different things.</p>

<p>That is why I keep a Book of Fail. I will write down the consequences and
circumstances of a particular catastrophe as a permanent record. I make sure
to physically write it down because the act of writing with a pencil, unlike
typing, requires significant effort, and helps to deeply ingrain what I have
chosen to record. Secondly, keeping these records in a physical journal means
that however many crappy Macs I burn through, or hosting plans I forget to pay
for, I will still be able to carry my Moleskine around.</p>

<p>Periodically reading through the Book is also crucial to keeping these painful
moments fresh. Many people will claim to have learned from a mistake, but will
continually repeat the same doomed process over and over without a second&#8217;s
thought. Once having a made a mistake a couple times, it should never be
repeated.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2009-06-07T00:00:00-04:00" pubdate data-updated="true">Jun 7<span>th</span>, 2009</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/best-practices/'>Best Practices</a>, <a class='category' href='/blog/categories/horror-stories/'>Horror Stories</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/2009/06/04/architecture-will-save-you/">
		
			Architecture Will Save You</a>
	</h2>
	<div class="entry-content">
		<p>There are two things that cause sites to go down:</p>

<ul>
<li>Something breaks.</li>
<li>Too much traffic.</li>
</ul>


<p>When things break, there&#8217;s nothing to do but <a href="http://chr.ishenry.com/2009/05/25/crisis-mo/">failover, examine, and
fix</a>.</p>

<p>But when there&#8217;s too much traffic, you&#8217;re screwed. The reason you&#8217;re getting
so much traffic is because you&#8217;ve done something to earn it. Your site has
made it on to Digg or Reddit or even TV. Failing over to a status page is
admitting that you haven&#8217;t done your job. Staying up means that some people
will see the site, maybe, but after a stupidly long wait. And then you become
&#8216;that site&#8217; that was taken down by too much traffic.</p>

<p>So as a web architect, this is your absolute worst moment. Everything you&#8217;ve
done over the past months or years is falling down miserably in front of you,
and there isn&#8217;t anything you can do at that moment that will make a meaningful
difference. Unless, of course, your architecture is set up so you can increase
capacity by just turning up more servers. Among software architects, this is
know as being able to <a href="http://bit.ly/14YkWx">scale horizontally</a></p>

<p>So when the site is being built, it&#8217;s extremely important that every choice
you make supports scaling horizontally, with each layer able to be spread
across many servers. Storage, session handling, database, apache [â€¦] are all
different layers. They all need to be able to handle more capacity just by
adding additional services to whatever layer needs it.</p>

<p>Having the horizontal scalable quality is really difficult when trying to get
a site out quickly. architecture is something that will often get de-
prioritized because there is no immediate result. However, taking the extra
time to build an application that follows the horizontally scalable patterns
is extremely important. Without spending that extra time, you can easily be
wiped out by the <a href="http://www.ndesign-studio.com/blog/updates/the-%0Adigg-effect/">Digg effect</a>.</p>

<p>The biggest takeaway is when thinking about how to build your application,
focus on making it scale horizontally. So when the moment comes when you get
on Digg, you can spin up some more servers, sit back, and have a drink.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2009-06-04T00:00:00-04:00" pubdate data-updated="true">Jun 4<span>th</span>, 2009</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/best-practices/'>Best Practices</a>, <a class='category' href='/blog/categories/scalability/'>Scalability</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/2009/05/30/success/">
		
			Success!</a>
	</h2>
	<div class="entry-content">
		<p>When making changes to a large site, it&#8217;s really helpful to have tools to
measure how those changes affect performance. One of my favorite tools is
<a href="http://bit.ly/1tFcP">cacti</a>. This is a graph of the load average of one our
database servers</p>

<p><a href="http://174.143.169.75/wp-%0Acontent/uploads/2009/05/cacti.jpg"><img src="http://174.143.169.75/wp-%0Acontent/uploads/2009/05/cacti.jpg" alt="Database Load Average" /></a></p>

<p>We done goodâ€¦</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2009-05-30T00:00:00-04:00" pubdate data-updated="true">May 30<span>th</span>, 2009</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/scalability/'>Scalability</a>, <a class='category' href='/blog/categories/systems-administration/'>Systems Administration</a>, <a class='category' href='/blog/categories/tools/'>Tools</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/2009/05/26/crisis-mo/">
		
			Crisis MO</a>
	</h2>
	<div class="entry-content">
		<p>While running any sort of site, expect problems. Lots of them. They will range
from trucks crashing into your data center, to bad releases, to people
defacing your site. Whatever the problem may be, there always seems to be the
same pattern in dealing with it.</p>

<ol>
<li>Fail over</li>
<li>Diagnose</li>
<li>Fix</li>
<li>Fail over</li>
</ol>


<p>This list makes a few assumptions. It assumes that there is an alternate
server for you to fail over to, and a means to do so. Having an alternate
server with a simple status page is really cheap and quick to set up. The
easiest way to fail over is probably to use DNS. <a href="http://dynect.com/">Dynect</a>
offers really great DNS service and has an interface that anyone in the
company can use.</p>

<p>Of course, failing over doesn&#8217;t necessarily mean you take your entire site
down either. It could mean pushing an update that closes a particular feature,
or removing data that&#8217;s causing a problem. Failing over really means any sort
of quick maneuver that will get you out of hot water.</p>

<p>Once you&#8217;ve failed over, it&#8217;s really important to understand what happened and
why. Knowing what caused the site to break is the most important step in
fixing it. When you&#8217;re in this situation, it&#8217;s really easy to put up a quick
fix without understanding what is happening. This can easily lead to thrashing
through a number of quick fixes that each break something else. In situations
like these, making decisions slowly and calmly is crucial. Anything that&#8217;s not
well thought out can make a bad situation worse.</p>

<p>Once the fix is applied, turn the feature back on or point DNS back to the
production site. When everything is back up, it&#8217;s well worth spending some
time making sanity checks on your fixes.</p>

<p>Lastly, it&#8217;s also well worth the time to thoroughly documentwhat went wrong
and why. The aftermath of crises is a golden opportunity to identify problems
with architecture process. It&#8217;s also a great time to do a few shotsâ€¦</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2009-05-26T00:00:00-04:00" pubdate data-updated="true">May 26<span>th</span>, 2009</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/best-practices/'>Best Practices</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/2009/05/19/a-tool-to-dry-off/">
		
			A Tool to DRY Off</a>
	</h2>
	<div class="entry-content">
		<p>Every developer worth their bits knows that code repeated is a maintenance
problem waiting to happen. However, code written by a group of devs under
tight deadlines tends to get pretty ugly pretty quick, with lots of snippets
being copy/pasted because &#8216;they work&#8217;. The allure of getting things up and
running quickly is a siren call that constantly lures us away from the all-
important refactoring and integration that makes code maintainable. But once
the dust has settled, and there is a spare moment to re-read and consider what
should be changed, the task of refactoring seems too daunting to even bother.</p>

<p>Thankfully, Sebastian Bergmann has created a tool that will find every dirty
little Ctrl-V. It&#8217;s called the php <a href="http://bit.ly/1C6nR">Copy Paste Detector</a>,
and can be installed using pear. Or download the source from git.</p>

<p>What&#8217;s really interesting is when you play with the number of tokens and
number of lines that constistutes a copy-paste. For my purposes, I used a
minimum of 5 lines. In quite a few cases, the copy/paste turned out to
declarations, or including the same style sheets and scripts on different
pages. But when it was php, it was abundantly clear what needed to be
refactored, and how.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2009-05-19T00:00:00-04:00" pubdate data-updated="true">May 19<span>th</span>, 2009</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/best-practices/'>Best Practices</a>, <a class='category' href='/blog/categories/tools/'>Tools</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/2009/05/16/framed--hijacked/">
		
			Framed / Hijacked</a>
	</h2>
	<div class="entry-content">
		<p>&#8220;There&#8217;s lots of bad stuff out there on the Internet.&#8221; &#8211; anonymous
<a href="http://www.Rackspace.com">Rackspace</a> tech</p>

<p>And bad people, too. On one occasion, I found that someone had hijacked a
domain similar to ours, and framed our site. Once they had the frame set up,
they started sending out spam from the hijacked domain. The legitimacy they
gained from having our site at their domain was really, really scary. Users
clicking links from their spam were sent to a site that was actually ours.
Luckily, we were alerted to this issue before any real damage was done.</p>

<p>There wasn&#8217;t much I could do server-side to fight this, without having to dig
into a bunch of PHP. However, checking the location window.top against what I
knew to be my domain turned out to be decent defense.</p>

<p>if (top.locationÂ != self.location) { alert(&#8220;someone is doing something
badâ€¦&#8221;);}</p>

<p>Of course, this particular defense will also complain about anyone who has
framed your site for any other reason. For example, the Digg toolbar frames
sites. So if anyone hits your site using the Digg toolbar, they&#8217;ll be treated
to your warning as well. But whether Digg should be framing sites in this way
seems to be <a href="http://bit.ly/15snr9">controversial</a> enough.</p>

<p>UpdateÂ : <a href="http://su.pr">su.pr</a>, which combines a URL shortener with the
StumbleUpon toolbar, has even further complicated the framing situation. (Full
disclosureÂ : I am a user.) Clicking any su.pr link will open the shortened URL
with the StumbleUpon toolbar. This has great potential for authors, who can
use the toolbar to increase traffic to their site, but at the cost of forcing
the toolbar on users.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2009-05-16T00:00:00-04:00" pubdate data-updated="true">May 16<span>th</span>, 2009</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/security/'>Security</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/2009/05/10/hard-file-limits/">
		
			Hard File Limits</a>
	</h2>
	<div class="entry-content">
		<p>A while ago, we ran up against a hard file limit on our storage server. Within
the main images directory, we subdivide our folders for every user. Well, it
turns out that on the <a href="http://en.wikipedia.org/wiki/Ext3">ext3</a> filesystem,
there is a hard limit of 32k folders within a folder. So when our 32001th user
signed up, they were welcomed by not being able to upload any content to their
nonexistent user folder.</p>

<p>So there we wereâ€¦</p>

<p>Several calls to our hosting provider <a href="http://www.rackspace.com">Rackspace</a>
yielded no elegant solution where we could simply reconfigure the limit. If we
wanted to continue on with our file structure the way it was, we would need to
migrate our data off the server, reformat the filesystem to
<a href="http://en.wikipedia.org/wiki/Xfs">xfs</a>, and migrate back on. That would take
us down for close to 36 hours. Needless to say that was not an option.</p>

<p>The other option was to quietly close registration, and start a mad dash to
implement programmatic partitioning. We created 5 folders next to our root
user content folder, numbered them 2-5, and assigned current users the
partition of 1. New users would be assigned a randomly generated number at
registration. Then we wrote a few quick utility methods to determine which
user belonged to which partition and began the quickest rewrite of file upload
system the world has ever seen.</p>

<p>DowntimeÂ : 0</p>

<p>In retrospect, someone (me) should have taken a scrutinizing look at the
characteristics of the filesystem that would be responsible for storing all of
our users&#8217; content.</p>

<p>Lesson learned, the hard way.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2009-05-10T00:00:00-04:00" pubdate data-updated="true">May 10<span>th</span>, 2009</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/horror-stories/'>Horror Stories</a>


</div>
	
</div>
</article>

<nav id="pagenavi">
    
        <a href="/blog/page/6/" class="prev">Prev</a>
    
    
        <a href="/blog/page/8/" class="next">Next</a>
    
    <div class="center"><a href="/blog/archives">Blog Archives</a></div>
</nav></div>
	<footer id="footer" class="inner">Copyright &copy; 2013

    Chris Henry

<br /><span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->


<script type="text/javascript">
      var disqus_shortname = 'thetechnician';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//go.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-6652794-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>



</body>
</html>
